use std::collections::HashMap;
use std::str::FromStr;
use bitvec::order::Lsb0;
use bitvec::view::BitView;

#[derive(Debug, Eq, PartialEq, Hash, Copy, Clone)]
enum Condition {
    Operational,
    Damaged,
    Unknown,
}

impl From<char> for Condition {
    fn from(value: char) -> Self {
        match value {
            '#' => Condition::Damaged,
            '.' => Condition::Operational,
            '?' => Condition::Unknown,
            _ => panic!("Bad condition character")
        }
    }
}

fn condition_string(cs: &[Condition]) -> String {
    cs.iter()
        .map(|c|
            match c {
                Condition::Operational => '.',
                Condition::Damaged => '#',
                Condition::Unknown => '?',
            }
        ).collect()
}

#[derive(Debug)]
struct Record {
    conditions: Vec<Condition>,
    damage_list: Vec<usize>,
}

impl FromStr for Record {
    type Err = ();

    fn from_str(s: &str) -> Result<Self, Self::Err> {
        let mut parts = s.split_whitespace();
        let conditions = parts.next().unwrap()
            .chars().map(|ch| ch.into()).collect();
        let damage_list = parts.next().unwrap()
            .split(",").map(|s| s.parse().unwrap()).collect();

        Ok(Record { conditions, damage_list })
    }
}

impl Record {
    fn fit_count(&self) -> usize {
        let mut memo = HashMap::new();
        let ret = Record::count_matches_memo(&self.conditions, &self.damage_list, &mut memo);
        // println!("{}: {}", condition_string(&self.conditions), ret);
        ret
    }

    fn count_matches(conditions: &[Condition], damage_list: &[usize]) -> usize {
        let unknown_count = conditions.iter()
            .filter(|c| **c == Condition::Unknown)
            .count();
        let state_count = 1usize << unknown_count;
        (0..state_count)
            .filter(|n| {
                let state = n.view_bits::<Lsb0>();
                let mut i = 0;
                let sequence: Vec<Condition> = conditions.iter().map(move |c| if *c == Condition::Unknown {
                    let bit = state[i];
                    i += 1;
                    if bit {
                        Condition::Operational
                    } else {
                        Condition::Damaged
                    }
                } else {
                    *c
                }).collect();

                &Record::describe(&sequence) == damage_list
            })
            .count()
    }

    fn count_matches_memo<'a>(conditions: &'a [Condition], damage_list: &'a [usize], memo: &mut HashMap<(&'a [Condition], &'a [usize]), usize>) -> usize {
        if memo.contains_key(&(conditions, damage_list)) {
            memo[&(conditions, damage_list)]
        } else {
            let ret = if damage_list.is_empty() {
                if !conditions.contains(&Condition::Damaged) {
                    1
                } else {
                    0
                }
            } else {
                if let Some(first_non_op) = conditions.iter()
                    .enumerate()
                    .find_map(|(i, c)| if *c != Condition::Operational {
                        Some(i)
                    } else {
                        None
                    }) {
                    let conditions = &conditions[first_non_op..];
                    if conditions[0] == Condition::Damaged {
                        //This has to be the start of the run if there's a fit
                        Self::start_of_run(&conditions, &damage_list, memo)
                    } else {
                        let assume_damaged = Self::start_of_run(&conditions, &damage_list, memo);
                        let assume_op = Self::count_matches_memo(&conditions[1..], damage_list, memo);

                        assume_damaged + assume_op
                    }
                } else {
                    0
                }
            };

            memo.insert((conditions, damage_list), ret);
            ret
        }
    }

    fn start_of_run<'a>(conditions: &'a [Condition], damage_list: &'a [usize], memo: &mut HashMap<(&'a [Condition], &'a [usize]), usize>) -> usize {
        let run_len: usize = damage_list[0];

        if conditions.len() >= run_len && !(&conditions[..run_len]).contains(&Condition::Operational) {
            if conditions.len() == run_len {
                // it fits, just, but check for further constraints
                if damage_list.len() == 1 {
                    1
                } else {
                    0
                }
            } else if conditions[run_len] != Condition::Damaged {
                // it fits this damage run; consume and move on
                let unused = &conditions[run_len+1..];
                let rest_damage = &damage_list[1..];
                Self::count_matches_memo(unused, rest_damage, memo)
            } else {
                0
            }
        } else {
            0
        }
    }

    fn describe(conditions: &[Condition]) -> Vec<usize> {
        let mut last = Condition::Operational;
        let mut count = 0;
        let mut counts = Vec::new();

        for c in conditions {
            if *c == last {
                count += 1;
            } else {
                if last == Condition::Damaged {
                    counts.push(count);
                }
                last = *c;
                count = 1;
            }
        }

        if last == Condition::Damaged {
            counts.push(count);
        }

        counts
    }

    fn unfold(&self) -> Record {
        let mut conditions = self.conditions.clone();
        conditions.push(Condition::Unknown);
        conditions = conditions.repeat(5);
        conditions.pop();

        let damage_list = self.damage_list.repeat(5);

        Record { conditions, damage_list }
    }
}

fn main() {
    let records: Vec<Record> = INPUT.lines().map(|l| l.parse().unwrap()).collect();

    {
        let counts: Vec<usize> = records.iter().map(|r| r.fit_count()).collect();
        let part1 = counts.iter().sum::<usize>();
        println!("Part 1: {}", part1);
        assert_eq!(part1, 7939);
    }

    let unfolded: Vec<Record> = records.iter().map(|r| r.unfold()).collect();
    {
        let counts: Vec<usize> = unfolded.iter().map(|r| r.fit_count()).collect();
        println!("Part 2: {}", counts.iter().sum::<usize>());
    }
}

const TEST: &str = r"???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1";
const INPUT: &str = r"#??#???.??#?#?#??#?. 6,8,2
?????????#?#.#?.?.# 4,3,1,1,1
.???#?#????..????. 1,4,1,1,2,1
??????#?.?. 3,2,1
?.?????#???#???#?? 3,1,2,5
????##???????? 2,4,2
?#?#?#??.?? 6,1
.??#????##?##???..?. 2,9,1
.???????#????#??#? 2,3,5
.?#??????##? 7,3
?????.???# 1,1,4
???#?#??##??#?#??#.# 8,1,4,1
#????#????#? 1,2,5
###.?##?.?#??. 3,3,4
??#?.??##? 1,3
.?#???.??????###.??? 4,1,1,3,2
??#?.?#?????.? 3,6
?##?#???.?????? 4,1,1,2,1
?????#????##??.# 1,9,1
.????#????###?..?. 8,4,1
##??#????? 2,1,3
.????.?#?#?#?##?? 1,8
?.?#?.?#????#???.? 1,2,1,4,2
.?#?#?#?.#??#???##? 1,4,5,2
??????#????? 4,1,1,1
???#?????? 1,1,5
??????????. 1,1,3
?#.???????#? 1,7
?????#???### 1,1,2,4
??.?#???#. 2,3,1
??..?.??#?.#? 1,4,2
??.????????. 1,4,1
.??#.??????#?.?#?? 1,1,1,1,2,3
?.?#..???. 1,1
???#?????????. 4,2
#?????.?????? 1,2,1,2
?#???????..# 2,2,1,1
?#.?#??#?????? 1,5,1,1
.#..?#????#??#? 1,4,5
?..???..?#?#?#?.? 2,6
???.?????#??#?. 1,1,6
?#?.#???????.? 1,6,1
.?#??#???##?#? 9,1
.##??#??.##??? 2,1,2,1
.????.?#?# 1,1,3
#??#..??#???.?##?. 4,1,1,1,2
..#?#????#? 3,3
?#..##?.??##??#. 1,3,3,2
??.????.???? 2,1,2
????#?????.?. 3,1
?#?##???#.?##? 8,2
????#.????.???#?? 2,2,1,1,5
..?.?.???? 1,3
?.??????????# 2,4
?.?.?..?##?? 1,1,3
????#????.?? 2,2,1,1
?.#????.##???#??#.? 1,1,1,3,5,1
?????##??#????? 7,1
?.???#..?#?.? 1,2,2
?#??##???#?.? 5,1
???#..?.#?#?##??# 1,1,1,7,1
??????#???.?#.??? 1,4,2,2
##??????#.??#? 4,3,3
.?.??#???.? 1,5
??#?.???#?? 1,3
???????..??? 1,2,1,2
#????.?#?#???##?? 1,2,3,5
?????????.? 1,2,1
..#?????.?# 4,1
#???.?##?## 2,1,5
???#.???#?. 1,1,2
?.?#.?????#?? 1,2,1,3
?.??.?#?#?#?#??#.??? 1,1,10,1,1
??#????????.??????? 7,3
.?#??.#???? 4,5
??????.??? 1,1,1
??##?..???. 3,3
?????##.???.?#?.. 3,3,2
????.?..???? 3,1,1
???????#?#??.#???. 1,7,4
.??#?????#.?? 1,4,2
?????#?#??.?.#?? 8,1,1
????#.?.????#???#? 1,1,1,3,1,2
?????#..?.???.#??#? 6,1,1,1,2,1
??#???#?.?? 2,1
??#.????????##??#? 3,2,7,1
?.?????#??.? 3,3,1
.#?????#?#?##?.??? 2,3,1,2,1
?#?#??.?##?###???# 1,3,10
??.?????.#???.? 1,2,1,1,2
??????..?? 5,1
??.??.??#??.#? 1,1,3,1
??.?.#?.?..?? 1,1
#.?#??????#.##?.?#. 1,1,1,1,3,2
#?###??##?##??#??? 5,9
???#.??????#.#? 4,5,1,1
??.???#####?# 1,8
?????????#??????? 2,1,5,1,1
?..?#??.?# 3,2
??#??.?.??#. 5,1
?#????##.???#. 8,2
??.?????###?##?????. 2,1,9,3
#???#?.??#???# 2,2,3,1
?????###????#????. 7,1
???????.??..?? 1,3,1,1
???????????????????? 3,3,1
#??????.?#?## 6,5
#??##??.?#???.??? 7,3,2
#.??##??#??####????. 1,13,1
?#.?????.##??. 1,3,3
#??.??#???.???#????? 3,5,6
?.??????.#??.?. 1,2,2,3,1
.????#???#..?#??# 4,1,5
????#?????? 4,2
???#????## 4,3
.#?.???#?.. 1,3
??#??#?????#?.?? 5,5
?.?.#?#?????????#??. 1,1,1,2,1,8
?###.???..?.#???? 3,1,1,1,3
.#??#??.???#????.# 1,1,5,1,1
????...?.?.#??? 1,1,1,4
???##???#?#??..?. 2,7,1
??#.?.?..?? 3,1,1
##?#?#?????#???. 7,1,2,1
??????????#?.#? 5,2,2,2
????##??##?#??..??? 13,1
???#???#???#???#.#?? 1,7,5,1,1
.??????###.???? 8,1
?.##???.?????#??? 2,1,1,5
.???#??##???????? 1,5,5
?????#??.????. 1,2,3
????#?#?..???## 1,4,4
???#????##?##?##?.. 4,1,9
..#??..????? 2,1
???#.?????? 2,1
???#...#???.?? 2,2,1,2
??#??#?????# 3,2,3
??#??????.???? 1,2,3
???.??.?#?#???#???. 2,2,8,2
#?????##??????#???. 11,4
???#?#????. 1,4,1
?##????#?#?.#. 2,1,4,1
#???#??????#? 8,3
#???#.?.#?.# 5,1,1,1
???????.???? 1,1,1,1
??.?????#???? 1,6,2
?.?.?.??#???. 1,1,4
?????#???????#..???? 1,3,2,2,2,1
??#?.????? 1,3
???###??..##.?? 1,5,2,1
??###?#???#?. 7,2
?.?#????#?????? 1,1,1,3,1
.#?????..? 1,2,1
?#?.?#?????????.?? 3,10,1
.???#???????..????#? 6,5
##?.???????? 3,3,3
.?##???.???###?.??? 3,6,1,1
.#??????.#?.???? 1,1,2,2,1
##?###??????????. 6,3
??.???#??#???.#??#.# 2,9,2,1,1
.??.###???????.#?? 2,7,1,1,1
?.##???.?. 4,1
.#?..?????#?????. 2,2,1,5
.?????.#??.? 2,1,2,1
.??.???.??..?## 2,2,2,2
??.???####?##?.???? 11,1
???.#.?#????.???# 2,1,3,1,1
?.??.?#???? 1,2,1
??#.?????#????..?#? 2,3,3,1,2
.?.?#??#????###??. 1,14
##??.??#?. 3,1
.#???..???? 1,1,2
.???.#?.#...? 2,1,1,1
?#??????#??#??#?? 9,5
.????#??????###.? 1,1,1,1,5
???#??.#?? 1,1
?#?.?#?.#???#?#? 2,3,2,4
?????#?#?????#?? 1,1,1,9
#?##??#?.#???. 1,5,1,1
?????##?????.??? 1,9,3
?.??##???#???.?? 1,6,2,1
?###???????.. 4,1,3
#??..???#??# 1,1,4,1
??.?..#??#???###?..? 1,1,1,7,1
??????.????? 2,4
??????.??. 2,1,2
.#???????????? 3,4,1,1
.#??..#????? 2,1,3
.?.??.????##???? 1,5
?#?????#?#??# 5,1,1,2
?####??.?.??.? 6,1,2,1
.???#??#?.?.?#????# 4,7
...??????#? 1,1,2
???#.#??#??? 1,1,1,2
?.?#????#??#???.?? 4,5,2
..????#???.?#?. 5,2
??..??#??????????? 8,1
?#??????..?.? 2,4,1
??#????.?? 3,2
??.?.??????? 1,5
?#??????#??###?#?.?? 1,2,9,1
.???.#????#??#? 3,2,1,1,3
????.?#?.??????? 2,4
?.#????#??#?? 2,5
?.##???#??????#????? 1,6,8,1
.???.??.?..???? 1,3
??????????? 2,3,2
.??????#?.?#.????.?? 1,6,2,1,1
???..?????? 1,4
??##?????... 5,3
.??#?#????.?? 3,4,2
??#.???#?????# 2,1,5,1
#.??##??#?.???? 1,8,1,1
?#?#??#?.?#?#??#?.? 7,7
??#????????? 3,2
?#..#?#????? 2,6
??##.##??#??#??.??. 2,6,2,2
??.??.?.????? 1,2,1,1
????#???????#? 4,2,2
.?..?#????????????.# 1,4,1,4,1
???????#.??? 1,5,1,1
????#.#??#???????#? 1,2,2,1,7
?.???#.?????? 1,4,1,1
.??.#????##?? 2,4,2,1
#????.#?## 4,4
???#?.??.???.?#?.?## 3,1,3,1,3
??.?#?????????####? 1,3,10
?.?#?????#??##??..?? 6,1,2,2
.???#??#?. 1,3
.?????###?. 1,1,4
??#?.??????#??? 1,1,4,2
.?#?.????#??? 2,3,3
?#???.????#???. 5,3,1,2
#???#??#???#??#?. 2,3,2,2,3
?.??????##???.???? 7,1
???#.##??##???# 2,1,3,3,1
????#?.?#?#???. 6,6
.???#????? 4,1,2
????#????##?#??? 2,8,1,1
.??????#?? 1,1,4
???..###.?##?##??? 1,3,6,1
####????.???.???.? 5,2,2,3
.??..?????.??.? 1,2,1
????..?#.#????? 4,2,6
???.?#????##??? 2,7
???????.?.#..### 1,2,1,1,3
#????????????? 3,4,1,2
???..#????????#???? 2,11
.???.????#?? 1,2,1
.?#?????..???. 6,3
.??????.????? 1,2,3
..???#?#?#?????#??.? 9,4,1,1
?##?.??#????#..##?# 2,1,2,3,2,1
.#?????#??##?? 1,1,4,3
?#???#????? 1,1,5
.?###..??.?#????? 4,1,5
????#???.. 1,1,1
??#????????..???# 9,3
.?#.?#.?.?. 2,1,1
??#??#?.????????#?? 4,3,3
#????..???#??.. 5,3
.?#?.??#?.???#. 1,4,3
#???#????.? 1,2,2
.#????.??##?????. 5,5,1
?????.???????# 4,1,2
.?.?###?##???????## 11,3
?????#?####???.??##? 1,6,1,3
?#.??.#??##?.##??? 2,1,1,3,2
..???##.?.? 5,1
???.?.???? 2,1,1
?.???#?#?.?#.??.# 7,2,1,1
?????.??.? 1,2,1
???.?.##??#? 1,2,2
?.#????##???????.?# 8,1,1,1,2
.??#.?#???#?? 2,8
.?#?#?.?????#??#?# 5,1,4,1
??##????.#..? 4,1,1,1
#????.????????????#? 5,2,1,1,2
?..#????.???.?.. 4,1
?#?.???#???.????? 2,5,1,3
??#??#?#??.?#?##?? 2,6,4
??#?##?.?????? 5,2
?.?.??.?#?? 1,1,4
?????.?#??? 2,4
.????.?#???? 1,1,2,3
.???????#???? 1,2,2,1
??.??#?????? 2,8
???.??????? 1,1,2
??#??#?##????#.?? 1,4,2,1,1
?##?????#??#.?#??#? 3,4,4
..???#?.?.#?#?.??.? 1,3
??????###???? 1,3,2
?????#???.?#?#?##? 1,1,3,1,6
#????????????.?.?#? 1,1,8,1,1
??#????##?#??????.. 1,10,1,1
?##?.???.??? 4,1,1,1
.?.???.#??# 1,1,4
?#.???#?#?????..## 1,1,8,2
??#??.??#?????# 3,1,1,4
?????#?#??? 1,8
???.?.????? 2,1,1
??#?.#?????.???.??? 1,1,1,3,3,2
??????.???#?#????? 1,1,1,6,2,1
??#?????#??.????..? 3,2,3
#.?.??????.??. 1,1,3,1
?#?.#????#???#?.???. 1,3,3,2,1,1
??##??????.?..? 6,1,1
???????#?.#??. 6,3
???#.????#??.#? 2,1,1,1,2
##???#?#?#?? 2,2,1,2
???????..## 2,2
??#?..?#??#?#.??? 1,7,2
???####?#?#.#???#?? 9,1,5
.?#?.#.???#?.? 2,1,4
????..??#..?. 4,1,1
??????????..??? 9,1
####?#?#??.???????? 10,1,1,1,1
#?#??#??#???????.?? 6,1,1,1,1,1
??.????????#? 1,1,1,3
#?..##?.???? 2,2,2
??#?????#?????.? 1,5,1,2,1
.?.?#??###??#??#?# 1,14
????????.????.?? 5,3,1
???????????#.?? 6,1,1,1,1
?.?.???#???. 1,1,2,2
#??#?????????? 1,1,1,7
?????#???# 1,4,2
?.??..#??. 1,1,1
.???#??#????????? 2,1,2,3,1
?#??.???#????#? 2,2,1,1,2
?###?????.?? 3,2,1,1
???????#?.????? 2,4,2,1
???..?#???#?.??? 2,1,1,2,2
#.#???####. 1,8
?.???#??????? 1,2,2
..#???##??#??#?? 3,5,1
?.???#???????#? 4,2,2
??##?.#??#??????? 1,3,1,1,5
##?#???.??.??#.? 2,1,1,1,1
??????#?????# 7,4
.???#??????##? 5,1,2
.??????#?##?#?? 2,6
.#?.??#.#?#??. 2,2,5
?..?##?#?????#??#?? 1,15
?????????????#???. 1,3,1,1,1,1
##?.????????.#?. 2,1,1,1,2
?#.???.#.?#??.?.?? 1,1,1,3,1,1
.#.??.?.?###.???? 1,2,1,3,1
???#?????##??.?.??.? 5,4
????###?#?##????.? 1,12
?#??.?????? 4,2
?????#??????.? 8,2,1
????????## 2,2,3
???#???#?? 2,2,3
????#.?.?#?????.???? 1,1,1,5,1,1
...????.?.?????#?. 3,4
..?..?#??#????#?? 6,1
.?#??.?????.?##???.? 3,4,5,1
.?..??#?.#? 1,2,2
????##??????.#? 1,8,1
???.##?#?.??##?? 1,5,5
#?????#??????? 1,8,1
.????#?????? 2,2
????##??.#? 1,4,1
?#?#?#?.???#?. 7,3
???????#??????.????? 10,2
????#??.?#.?? 3,2,1
???.#.?#?##?????# 1,1,5,3
???##.#?##?????.?.# 1,2,1,7,1
????.##?#??##??? 2,10
?#?.????#??#?##?#?#. 2,12,1
????#??#??.??#??? 4,2
??.#????#?.??? 2,1,5,1
.###?.??.?#.#.?.???? 4,1,1,1,1,2
??#??###?.#?.????.# 8,2,3,1
?##???.?.##??#??.??? 6,1,7,2
??###??.????##?#?##? 3,2,8
#???????#??#?#??#??? 4,4,9
??#????????# 2,3,2
?#?.?.#?.?.?????# 3,1,2,1,4
?#??##?#???.?..?. 7,1,1,1
???????#.?????##.?. 8,1,3,1
..???##.??# 1,3,1
.#??#?..####?#. 4,6
?????..??????# 5,1,2,1
???##?##.????##?# 1,2,2,1,5
???.??#???.?. 2,1,3,1
???.??###??????#?#? 2,4,6
?#???#?#??????? 6,3,3
?##..?#???????## 2,10
?#??.?.#?.?# 3,1,2,1
#???.#???. 3,3
???.?.#?.#??#?????. 1,1,2,1,3,1
?...?.??????? 1,4
??.????.#.? 1,3,1
????#??.?.###.???? 1,4,3,3
?????..???.?? 1,1,2,1
.??.??##????#?. 2,8
??.??#??????. 5,1
###??#??.??? 6,3
##????##????##..? 2,11,1
??.????.??????? 1,2,1,1,2
.???????????????.?. 5,5
??...?????.? 1,1,1,1
????###?##? 4,2
??##???#?????????? 5,7
?????????.?.# 6,1,1,1
?????.???? 1,1,3
??#??????## 4,4
???.?#..?#?##.?.#??? 1,1,5,1,1,1
.#?.#??????. 2,1,3
.????.?????##? 1,1,7
???.???????. 1,1,3,2
.???##??..??.#..#? 7,1,1,1
??#????#???????????? 15,1
##??????..???? 6,1
#?.???#??? 1,3
?##????#???#? 2,6,2
###??#???#???????? 6,1,1,2
.???????.? 1,1,1
??????#??..?.##?##? 8,1,5
.?##?????.?. 6,1
.#???.????#???# 1,1,1,4,1
.#??.#?##?#? 3,1,2,2
#?????????#??##?# 1,3,2,1,5
???.??#????? 2,6
?.?#??..??## 1,4,1,2
..???????????.? 5,1
???.#??#.??????#?.? 1,4,8
?????.#???#?#?? 3,1,3,1,1
???????.?#??##????? 1,3,6,1,1
?.##????????###?? 3,3,6
#??????.##??## 1,1,1,6
?#.??.?.?#?. 1,1,1,2
#???##??##?.?.????#? 2,4,2,1,1,3
.???????.??# 2,1,3
???##?##?#?#????? 11,1
???????#?#??. 6,3
????#???#?.????#.? 10,1
?#?????.?#????#? 4,6
?.???.?#.?. 1,1
.??.#???.?. 1,1,1
?#?????????????? 1,1,1,5,1
???.?????#? 1,1,4
???#????..?? 6,1
?.#?????#?????.?. 10,1
?.#??.#?.#?.? 2,2,1
.??#???.?##?.#?. 1,1,1,3,2
#?#???#?#?????#?#?? 15,1
..???##.?????.???#?? 3,4,3
.??.???????.? 1,4,1,1
???#?????.??.?????? 5,1,1,3,1
.??????.?.??#??? 5,1,3
??#?????##???. 1,9,1
.#???????????.? 1,1,2,2,1
??#?.??.??? 3,1
???.???.??.???????? 1,2,1,3,3
?.##??????#? 1,4,3
?#?##???#?#..? 9,1
????????.?.???? 7,2
??#????#?#?.???? 2,5,3
.?.??.#??#?????. 1,4,3
.???#??#?.#.??##?# 8,1,6
?..?.??.??????..?..? 1,1
??.?.??????? 1,1,1,2
.?#..????? 1,2,1
??#?.????.##???? 2,2,2
?????#?##??.???.? 1,6,2
??????????????. 4,4,1,1
???##..?????##?#??? 4,10
??...?##???#?#??? 1,3,6
.?.#.???#?#?#?? 1,1,1,5
.?#??##???##??.#?# 12,3
?????#.??.?##?????? 3,1,1,4,3
??#.#.??#.#??? 3,1,3,3
#???????????#?? 1,2,1,6
???.?????.??.? 3,1,1,1
??#???.?????# 3,1,2,1
??..????.?..?? 2,2,2
.#???#??#????#? 11,1
???.??.????#??..?## 1,1,1,4,1,2
..??##?????.?.?#? 9,1
??##?#?#??#???? 1,10
#?#?????????#. 3,9
????#????#?? 5,4
?#???#??????????#. 7,2,1,1
.#??#?????#.?#.??#. 5,4,2,1
#??.#?.?????.#? 3,1,1,1,1
.?#??????.??? 3,1,3
???.?????#?#???? 1,1,1,3,1
.#????##?#??.#. 1,3,1,1,1
???#?.????#?? 5,2
#.??##?####?.???? 1,1,8,1,1
.?.??#??????. 1,4,1
??????.?#? 6,1
..???.#?##?.???.? 2,5,2
??###????????.????? 5,6,2
????.????? 2,1,1
???.?#???#??#? 1,6,1
..#?.???#?.#?#? 2,1,1,1,1
??.?###?#????#??. 8,1
?###???##??????? 3,8,1
.#.#??#?#?. 1,2,3
.???#.?..##?????#??? 4,5,3,1
???###??..??? 6,1
.##?###?????#???#? 6,1,2,2
#.??????#?? 1,2,3
.?.#?##??##??????? 8,5
??????????# 1,4,1
.???..???????.? 1,7
#?##??.#????#.?? 1,3,1,1,1
?#?#??.??#? 5,1,2
?.?#?#??#??##??. 4,7
##?.???????.??????? 2,1,4,5
??.?????????..??#?? 1,4,1,1,1,2
??..??#???????? 1,2,1,2
?.#???#??.?#?#? 1,2,1,1,5
??.?????##????.? 2,10,1
?.????.#???#??.? 1,3,1,3,1
??#??#????..????? 8,1,3
?????#?#??#### 1,1,3,5
?.??#???????..#??? 1,6,1,3
##?#???????.#??? 7,2,4
??#?..????#??##??# 4,1,2,2,1
??????#??#?.?#?##??. 1,9,2,2,1
???#?.????.????? 2,3
.?.?????.??????.?# 1,1,2,1,2
.??????##.??? 8,1
??#..#????## 1,1,1,2
???.??.?#?#?. 1,1,3
?????.?????.??? 2,5,1
.#?#???.????? 5,1
#???#?#???#?.?.????? 3,8,3
#?.#?.???.??? 1,1,3,2
??#?#?#?#????#.? 9,1,1,1
.#???#..?????. 3,1,1,1
??#.??????#. 1,1,1,1
???#?##?.???...??. 1,5,2,2
???.?.????#. 1,1,1,3
???###?.??#???. 5,5
?..?.??#???.???.?..? 4,1
.??#?.???#??..?# 2,4,2
?#????#??#?? 1,1,1,3
#??????#???#??? 8,1
??????#.?.?.?. 1,5,1
??.??.?????.#? 1,4,1
?#??#?##???#????.# 1,5,3,1
????????.#?#???? 3,3,4,1
???????????..??????? 1,1,1,1,1,6
???#??#?#??##?## 1,1,1,8
??????????????? 2,1,1,1,1
?..???.?????.#? 1,1,1,1,2
??????##?????.?#?.?? 1,8,2
.?.?#??#???? 1,1,1,1
.???#?????.? 4,1,1
????..?#?? 2,2
????#??.#? 5,2
????..?.#.? 1,1
????????#?? 1,2,1
????#?..?.# 3,1,1
?##?????#???? 6,2,1
????.????####??. 4,1,6
??.#?#?#.???????? 2,5,2,1,1
?.#??.?#??????????? 1,1,1,3,5,1
??..?.??#??? 1,3
??.??...?????#?#?? 2,1,9
??##?#??#??. 4,4,1
??##????#???# 8,2
.???#?????.. 2,2,3
????????.?. 3,1
?.???#?????????????? 1,1,4,2,2,1
.?##???.???????? 3,5
??#??...#??#? 4,1,1
????#.####. 3,1,4
.##???.??? 2,1,2
??##???????? 1,4,1,1
.#????#?.?#?#? 1,3,4
.?????##?#??????? 1,8,1
.#?.##?.#? 1,3,1
?#????.????? 5,2,2
??.##?.??#.?????? 3,1,1,6
??.????#.?##??#?. 2,1,1,6
??.?????.??.? 2,2,1,1
?#?#??#????.?#??##.# 10,3,2,1
?#??#?..??#????.??? 4,2
?#...???#??.? 2,1,3
#??.??.#???#..??? 3,1,1,1,1
??#?????..#??.#?.??? 5,3,2
#??####?.#????#????? 7,2,1,1,1,1
..#??.?.#.???.??? 3,1,3,2
....??#?????.??##?.. 7,3
.???##??.?? 3,1
#.?#?..?###?#?#? 1,2,5,1
???#?.??#????#?? 5,1,1,1,2
??##.?#?##??????.?? 1,2,5,1,1,1
#???#??#????..??# 8,1,1,3
.?#??..#.?????? 2,1,1,3
????????..????? 1,3,1,2
.?...?#?#?????? 1,9
.?#?.?????#?????## 1,1,10
#??..?#?#?.? 2,5
??#.???#?.???#??? 1,5,1,2,1
??.?.###?##?#?#?#? 1,1,8,1,1
.?.???#??###.?????? 1,2,6,1,1
?????.?#?#?#???? 2,1,6,1
???????.#?#????##. 1,1,9
.?##?.?????? 3,2,1,1
????#??#????#????? 2,3,2,2,2
?##?##???#?#????#?# 5,1,1,1,1,3
?.??#.?#???#????? 1,3,1,6,1
?#???#?#.????.?. 1,1,1,3,1
?..?#??..# 1,3,1
?##?????.#????#? 3,1,1,1,1
??#..??##??#? 1,5
.?.#..???????? 1,1,2,4
?.????????.#? 1,1,2,1
???####?.?#??? 6,4
??????..#?? 2,2
?.??????#??.? 1,7,1
???#??????. 1,4
???.?#????.??.#.?. 2,2,1,2,1,1
.?##.#?????#??# 3,1,2,2,1
????.?#?????????? 1,9
?.??#?????.?. 3,1
#????#.??????. 6,1
?.???????.???# 1,2,2,1
#.?#????????.?? 1,5,1,2,1
.?.#.?#????#? 1,3,2
???#?#..??.# 6,1
.??????.?????##? 4,2,3
.???.????#?#..??? 2,4,1
?.????...?? 2,1,2
???????#??#??#?#?. 2,9
?????????#?????.? 1,1,5,4,1
.????.??#?..#??? 3,3,2
??#?#?.?.?###. 5,3
????????.#?#???? 1,1,1,1,5
.##?#?#?.?.???????? 2,1,2,1,7
?????###.?.???#? 7,5
??.??#.??##???? 1,2,4,1
#??#?????? 5,2
...?.?????.??#. 2,3
??#??.??.. 1,3,1
?????????.?#??#???.? 3,2,8
???#??????#.#?#???? 5,2,1,1,1
??#..?##???##?. 1,3,3
??.????#?#??????# 1,1,9,1
??###????. 1,6
.??##?##?.??#?#? 8,1,1,1
?#..??#???? 1,1,3
???##?????#??????.? 3,4,1
????#?..?????.?#?.?. 4,4,2
?#???.??#???..? 1,2
.?#??#..???? 4,1
.?##...??##? 3,1,3
????????#???#?#. 2,2,3,2,1
#???#?#???#?#?#??? 5,1,3,5
??#??###?#??.?.?# 10,1,1
.??#?#??#?#??#? 3,1,2,5
?????.?#??????#.???# 2,1,4,1,1,4
?.#?#?##???.#?? 1,6,1,3
??????#?.??? 1,5
#??##.?##??? 2,2,3,1
?#?##??????##.??? 7,3,1
??????#????..??? 10,3
##?.????##???#.? 2,10
??...???????#? 1,9
?..?###??.?.??#??. 5,4
?.??##.?.??#??#???? 3,9
#???.??#???#???? 3,4,3,2
????????#?#??#??? 11,3
?????#?????#...?? 3,1
#?????..??##?.??? 1,4,3,1
????##??##?###.#. 1,1,3,6,1
?#???.#.?? 4,1,2
#.?.???#??#.? 1,1,2,1
????.?????#??????. 3,8
????.?.#?#? 4,4
???#??#????##??.. 6,5
###??#????#?.. 7,2
??.??#???###?. 1,7
????????.?.?#???? 3,3,1,4
?#?#..##???????# 3,2,7
#?????.??????? 2,1,1,6
#??..?#??## 3,2,3
??.?.????.#??? 1,3,4
.?#???##.???.??? 6,2
??.??.?.?#####?? 1,6
?#???#?#.?.????..? 7,3
??#.??###?###?.? 3,7
?.?.?..??###? 1,1,1,6
??.??#??#?.??.?? 1,4,1,1,1
?#?#?.##????? 5,2,1,1
#??????#?. 5,2
?#?#??.?..?.? 4,1
?????????..#.??? 2,2,1,1,1
.?..????#??#?##?#? 1,1,1,10
??????.?????.??? 4,3
???????????#?. 4,2
.????#??.?.??#???#? 1,3,1,2,2
??##?#????##?##???#? 6,10
?#???????????. 5,4
???##?#?????#.?.?# 10,2,2
.????.???#?##.????? 2,7,2
??????##???.?.????. 1,4,2,1,1,1
???#?????#??#????#.? 1,3,4,3,1
?#???#.#??.? 2,1,1,1
?.???#?.??#?#??? 2,8
#.????#?.?..??#? 1,1,2,1,3
.????.?????.? 3,1,2
?????#?????.? 3,2,3
?#?.#??##?. 3,1,2
??###??????? 6,1,1
????????#??? 1,1,3
???.?.#??? 1,1,1
.??.??#.?? 1,1,1
?##.???##???#?#.??? 2,7,1,2
?#??.??.#??#???? 2,1,2,1,1
##????#?##?.?#.?? 3,1,5,1,1
?##?.?#.#??##? 3,1,1,4
#??.??????? 1,4
.???##??????.????#?? 1,8,1,2
???#.#.?????????? 1,1,1,10
????.?#??#?#??#?? 1,10
?.?????.???.??#??? 1,1,1,2,2,1
??.???##.?????? 5,2
??.?.#???#??? 1,1,3,3
????##????..#??? 6,1,1,1
?????#.??#?##.?? 2,2,4,1
?#..???????? 1,1,3
#??????#?...#? 9,2
?..?.??#?.#? 1,1,2,1
..????????? 1,1,1
??.??#??.???.? 1,5,1
..?.##..??#??#?????? 2,10
???#..?#???#????? 1,1,2,8
.???????#.????#?? 4,2
???.?#???.???.?.. 2,3,2,1
??#?#?????#??? 1,4,1,2
????#.???..#?### 3,1,1,1,3
????#???..?#?# 4,1,2,1
?.??.????##?#?#.? 3,6
.???.????????#????? 1,7,1,2
??#??.??#???.? 3,4,1
.??.?#.?##?????.?.. 1,2,2,2,1
#???.?.??? 4,1,2
?.??.?#??#?????????. 2,5,4,1
..??????????????#?.? 1,6,2,1
??...#.?##? 1,2
.???####?#.???. 1,6,1
??#..??#??.?##?# 3,1,1,2,1
#?..?##??..??#? 1,5,1
?#?#????????? 6,1,2
?.#?.?.#???? 2,1,5
?..????#??????.?. 1,2,1,5,1
.???#??#???#?#??#? 2,3,4,1
.???....#??.??. 1,3
???#?.??..#???. 1,1,1,4
...???.#?? 1,1
.#???.???## 1,1,5
??#??##???.?????. 4,5,5
??#?##?...??? 1,3,2
#????#.????#?#??? 1,1,1,7,1
????#??#..?.??????. 8,1,1,2,1
?#????#??#?????#.?? 8,4,1,1
.?????.##??????#???. 1,1,12
#??.??#??? 2,3,1
.?#?###?#??###?#?#?. 1,15
?#.#?????# 1,4,2
??#???###???????#?.# 9,7,1
.??.??#???. 1,4
.??.?#???#???.###?. 1,7,3
????#??#???#?.??? 1,1,2,3,1
???#?#?????..?.????. 10,1,1,1
??##?#??#?????#????? 1,7,1,6
??.?#?#???.????? 2,7,2
??#?.?.????. 3,3
.??#.#?##??? 1,1,6
??#??????###??.? 1,3,1,3,1
..?#?.#???.?#? 2,1,1,3
?.?##????#.?#?? 7,3
??###???.?. 4,1
??.?#?#??#??. 1,7
??????.##?.#??#?? 1,1,1,2,6
?.?###.?#???#???##?? 4,11
.#?#??##?.???#???? 8,5
.?.??##???.??.? 1,7,2
????????#???#??? 3,2,5,2
??.?###.????????.?# 1,4,3,1,1
#.????##??#??????#? 1,1,13
#????#???#.??#. 1,5,1
????????#???#??.??# 1,1,1,8,3
????.?????.??# 3,4,1
??.??#???.. 1,4
??.??##?.????##??? 2,3
????????????#?????? 1,10
?#??#??.?.#?.#....?? 7,1,1,1,1
?.?#????## 4,2
.?.#????##. 1,5
.???????????? 3,1,1,1
#?????????.?###?# 2,3,1,1,5
?#?#.#??#.??? 1,1,4,1
???.#??????????? 2,8,2
##?#?#?.???? 6,2
??.?????##.#? 1,1,4,1
??????.#?##? 1,4
???#????????.#.????? 4,1,3,1,5
?#?..??##? 3,4
?????.??##?.? 2,1,2,1
?#????#????? 1,7
.???#.??##???????. 2,1,7
???####?.?#??..? 6,3
?.?#???.????. 5,1
.?#???.?###?#??## 3,1,10
?###??????#?????###? 5,5,3
.??#?.????#? 4,2
##.?##?#.?.#??#.??? 2,2,1,1,4,2
????#?????#?##??##?? 3,1,2,6,3
...??##..??# 4,2
?.?.#???#? 1,1,1
.#???.????? 1,2,1
.#???#???#?#????#. 1,1,2,1,1,2
???.#??????? 1,3,1,1
.??#???#??#????#?? 1,2,1,8
?#????????? 4,1,1
?????##??##?? 3,7
??.????#.??? 1,5,1
.??###?##??#?# 7,3
???##?..?? 1,3,2
??#.?.????#? 2,1,2
?#??#???#??#?.#. 2,1,6,1
?.?????.?#?. 1,1,1,2
.??#???#?.?#?#??# 3,3,2,1,2
?#??..#.???? 3,1,1
????????#????.?.#? 1,1,6,1,1
??#?#??????#?.?.?.#? 5,1,3,1,1,1
???#???????#??#??. 2,3,10
???#?#?.?????#?#? 4,1,5
?..??#???????????? 1,4,1,1,1,3
#.?????###?#??? 1,12
?.??????##??#??????? 1,11,2,1
#?.??##??#??. 1,9
????#?????????? 9,1
?#.?#??.???.?????#? 1,3,1,1,1,2
??.?..????.?? 1,1,3,1
?#..?#???????.? 1,2,2,1,1
#.??#??#??#? 1,7
#?#?#???????.?????. 6,5,1,1
.????????.?#?#. 1,1,1,4
??.???????#. 1,1,1,1
??????.?#.???? 2,1,2,1
..?#?##???????? 2,7
?#?#?????.??? 8,1
#?.?#????.?? 2,3,2,1
????.?.?#???? 1,1,2,1
?.???#?.??.?.?.?. 4,2,1,1,1
.#???#?#??#??. 1,9
?????#??.?? 3,3,1
?#?????..?.??###?# 5,7
?????#??.##. 4,2
.##.??#??????#?##. 2,2,6
#?.???.?#?.?????. 1,3,2,1,1
?##?#?????? 2,4,1
?#?????#??????#?. 10,1,2
.?#..?#???##?.???? 2,1,4,2,1
???????.????##.??? 3,3
??###?.????.??##???? 6,2,1,3,1
.#?####??.?.?#???# 8,5
?????????# 1,7
.??..###???#??#?.??? 10,1
#????..????#?#? 1,2,2,5
????###?????? 8,3
#..??.???????#??? 1,1,2,1,4
.?#????#?#??.?? 11,1
?#?????#..??#?.??? 5,1,1,1,1
?.??#??????##?##.. 1,2,1,1,6
?###?????#.?# 8,1,1
??#??.?#???????## 3,3,5
??.#?????.?????#???? 1,1,1,1,2,4
??????????? 1,2
..???.???#? 2,3
??.??#?????#????.? 2,8,2,1
?????#??????#? 1,4,1,3
?.?????..??? 1,1,2,1
?#??#????##?????#??# 4,3,7
?????.?##??.????.#. 3,3,1,1,2,1
?#???????????#.??#.? 2,9,3
?????###.??.#.?????? 1,4,1,1,1,2
.?###.??.? 3,1
???....??##.? 1,4
??###??.?.#?..?? 5,1,1,2,1
???##??????#???? 3,1,3,1
?????#???????#.? 2,1,1,1,3
???????#??#???# 2,10
.??##????????? 1,2,6,1
??.#?#???????# 1,4,1,2
???#?.?##?#.????? 1,3,4,1,2
?#????..?##? 2,3
??????#??.?????? 1,6,2,1,1
.?##??.?.?#????## 5,3,3
?#??????.????#??.??? 1,1,2,6,1,1
?.??#??..##?.??. 1,5,2,1
?#?..???#?.?? 3,5,1
??????..???? 3,1
.?.???????#????. 1,9
??????#?#??????.???? 14,1
.????????????#??. 1,7
????#.?##?## 3,5
.?.##?????.? 1,3,1
???#??????##??#??. 1,1,11
????##????? 2,2,2
????????.??.#??#??. 3,2,1,6
#???#?#??#???. 1,7,1
..???????????.##??? 9,5
??.????????#??# 2,1,1,2,1
?#??????..?. 3,1,1
#???.??????.#??.? 1,1,2,2
?#??????.# 2,3,1
????#??.##?.??#. 1,2,3,1
.????#???????#? 2,1,4
.?#????.?.???##. 1,3,5
.?.?#????#. 3,1
?#???.???#?##?? 3,1,5
????#?#?????????..?. 9,2
.?????#????????##?#? 4,1,1,1,2,5
.???#??????????? 1,5,6
??.??#?##???##?? 1,4,6
??..??.##?# 1,1,4
#???.??????????????? 3,11,1
?.?##????.???????? 1,3,2,7
?#??.?.?#??.? 3,1,3,1
..??#??.???#?????? 3,5
???#.??????? 3,1,3
?#?##??????? 9,1
???#??#???????# 1,7,1,1
??##????.##???? 4,2
.#..???..??#?.?#?# 1,1,1,1,2,1
.?????..?? 1,1,2
?.????????. 1,5,1
?#????.??.#.?????#. 3,1,2,1,2,3
?#???????? 3,1,1
??#?#?##????#?? 9,3
.#??#?#??. 1,3
.#??#?.??#?#?..? 4,1,2,1
.???.?.?#?#?.?? 1,1,5,1
?..???#????????..? 3,2
#??#???.???#?????#? 6,1,4,3
?????#?.????????.? 1,1,8,1
.#??#????.#?.#?? 1,3,1,1,1
??????????????#?#?? 1,10
???#?#?#?? 1,1,3
???.?????#.#? 3,1,2,1
???.???.?# 1,3,1
?#?????..?#???#??? 6,3,4
?#?#??.##?. 4,2
??????????#?.????. 1,6,2,4
?#??#?????????? 1,9,1
???##?#??#??? 1,9
#??????##?? 2,6
??.??????#?#?.???.? 1,3
.?#?#?.?????????.? 2,1,1,2,1,1
??..#????.###?#? 2,1,1,1,5
???.?????#??? 1,4
.?????##?#?..?.? 3,5,1
.#????#??.???.?# 1,1,2,2,1
??#???##?#?????.???? 8,1,2,1
#?#.#????.?#???? 1,1,5,5
.##????#??#..?.?.?.? 7,2
#????#?????.? 1,1,2,3
??.#????#? 1,2,1
?#?????..??#.??? 4,3
.?????#.#??.? 6,1,1
??#?.??????.??#.??# 3,6,1,1,1
#?#?..??##????????# 4,13
????###?.??#...??#?? 7,3,3
?????????#.???# 8,2,1
??###??##?..?.??##.? 10,1,2
.#?????????#???#?#. 4,1,8
????#?.????#???..? 5,1,4,1,1
??.????.#?????##? 1,3,1,1,2
??.#??#.?.?? 1,1,1,1
??.??????#?? 1,6
.???.???.##??.?. 2,2,4,1
???#?###?.?? 1,1,3
???#.?????..#.. 1,1,2,1,1
?#?#?.??????#????# 1,2,1,1,8
#?????.????? 1,1,1,1
.????#..?? 4,1
??###????????#?##.? 1,3,1,1,4,1
????..?.#?.. 2,2
??????#??#??.?? 1,1,1,4,1
?????#????.?????# 1,7,4
?.#???#?#?? 1,7
??.??.??.??..##??#?? 2,2,1,6
????.??##?. 1,1,5
#?#.#??????.#.?#?.?. 3,4,1,1,1,1
#?????#????? 2,5,1
??#?#?????.#?#?? 6,4
..???#??????. 1,1,5
.?.?#.#???#???? 1,1,1,4";